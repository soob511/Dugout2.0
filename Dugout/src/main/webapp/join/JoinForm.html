<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Join Form</title>
    <link href="../common/bootstrap/bootstrap.min.css" rel="stylesheet">
    <script src="../common/jquery/jquery.min.js"></script>
    <script src="../common/bootstrap/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="JoinForm.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css">
</head>
<body class="join-body">
    <header id="main-header"></header>
    <hr class="join-hr">
    <main id="member-form">
        <section class="title">
            <span class="join">JOIN</span>
        </section>
        <form class="row g-3">
            <fieldset class="col-12">
                <div class="mb-3 form-group">
                    <label for="inputId" class="form-label">아이디</label>
                    <input type="text" class="form-control" id="inputId" placeholder="예) dugout (영문 또는 숫자 4~12자리)">
                    <button type="button" class="id-check">중복확인</button>
                </div>
                <div class="mb-3 form-group">
                    <label for="passwordIn" class="form-label">비밀번호</label>
                    <input type="password" class="form-control" id="input-password" placeholder="영문, 숫자 조합 8 ~ 16자">
                </div>
                <div class="mb-3 form-group">
                    <label for="passwordInConfirm" class="form-label">비밀번호 확인</label>
                    <input type="password" class="form-control" id="password-confirm" placeholder="비밀번호 확인">
                </div>
                <div class="mb-3">
                    <label for="inputName" class="form-label">이름</label>
                    <input type="text" class="form-control" id="inputName">
                </div>
                <div class="mb-3">
                    <label for="inputPhone" class="form-label">전화번호</label>
                    <input type="text" class="form-control" id="inputPhone">
                </div>
                <div class="mb-3">
                    <label for="inputAddress" class="form-label">주소</label>
                    <input type="text" class="form-control" id="inputAddress">
                </div>
                <button type="submit" class="btnMember">회원가입</button>
            </fieldset>
        </form>
    </main>
    <footer></footer>
    <script>
        $(document).ready(function () {
            // 페이지 로드 시 헤더와 푸터 로드
            $("footer").load("../main/Footer.html");
            $("header").load("../main/Header.html");
        
            // DOM 요소 참조 및 초기 변수 설정
            let userId = $('#inputId'); 
            let idCheck = $('.id-check'); 
            let passwordIn = $('#input-password'); 
            let passwordReInput = $('#password-confirm');
            let memberButton = $('.btnMember');
            let isIdValid = false;
        
            // 유효성 검사 함수
            function checkForm() {
                let password = passwordIn.val();
                let confirmPassword = passwordReInput.val();
                let name = $('#inputName').val();
                let phone = $('#inputPhone').val();
                let address = $('#inputAddress').val();
        
                let isValidPassword = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d\W]{8,16}$/.test(password);
                let isCompleteForm = name.trim() !== "" && phone.trim() !== "" && address.trim() !== "";
        
                if (!isValidPassword || !isCompleteForm || !isIdValid) {
                    return false;
                }
                return true;
            }
        
            // 아이디 중복을 체크하는 함수
            function isDuplicateId(id) {
                let users = JSON.parse(localStorage.getItem('users')) || [];
                return users.some(user => user.id === id);
            }
        
            // 아이디 중복 확인 버튼 클릭 처리
            idCheck.click(function () {
                let username = userId.val();
                if (username.length >= 4 && username.length <= 12 && /^[A-Za-z\d]{4,12}$/.test(username)) {
                    if (isDuplicateId(username)) {
                        alert('이미 존재하는 아이디입니다.');
                        isIdValid = false;
                    } else {
                        alert('사용 가능한 아이디입니다.');
                        isIdValid = true;
                    }
                } else {
                    alert('아이디는 영문 또는 숫자 4~12자리로 입력해야 합니다.');
                    isIdValid = false;
                }
                updateButton();
            });
        
            // 버튼 상태를 업데이트하는 함수
            function updateButton() {
                if (checkForm()) {
                    memberButton.prop('disabled', false).addClass('active').css({'background-color': '#333', 'cursor': 'pointer'});
                } else {
                    memberButton.prop('disabled', true).removeClass('active').css({'background-color': '#ebebeb', 'cursor': 'default'});
                }
            }
        
            // 입력 필드 변경 시마다 버튼 상태 업데이트
            $('#inputId, #input-password, #password-confirm, #inputName, #inputPhone, #inputAddress').on('input', updateButton);
        
            // 회원가입 버튼 클릭 처리
            memberButton.click(function(event) {
                event.preventDefault();
                if (checkForm() && passwordIn.val() === passwordReInput.val()) {
                    let newUser = {
                        id: userId.val(),
                        password: passwordIn.val(),
                        name: $('#inputName').val(),
                        phone: $('#inputPhone').val(),
                        address: $('#inputAddress').val()
                    };
                    let users = JSON.parse(localStorage.getItem('users')) || [];
                    users.push(newUser);
                    localStorage.setItem('users', JSON.stringify(users));
                    alert("회원가입이 완료되었습니다!");
                    location.href = '../main/Main.html';
                } else {
                    if (!isIdValid) {
                        alert('아이디 중복 확인을 먼저 해주세요.');
                    } else if (!(/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d\W]{8,16}$/.test(passwordIn.val()))) {
                        alert('비밀번호는 영문과 숫자를 포함하여 8~16자리로 입력해야 합니다.');
                    } else if (passwordIn.val() !== passwordReInput.val()) {
                        alert('비밀번호와 비밀번호 확인이 일치하지 않습니다.');
                    } else {
                        alert('모든 필드를 입력해야 합니다.');
                    }
                }
            });
        });
    </script>        
</body>
</html>